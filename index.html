<!doctype html>
<html>
<head>
  <title>Ejemplo Apuesta Snarkjs</title>
</head>
<body>
  
  <h1>Ejemplo Apuesta Snarkjs</h1>
  <button id="bGenProof"> Create proof </button>
  
  <!-- JS-generated output will be added here. -->
  <pre class="proof"> Proof: <code id="proof"></code></pre>
  
  <pre class="proof"> === > Proof Result: <code id="result"></code></pre>
  <pre class="proof"> === > Winner: <code id="winner"></code></pre>
  
  <script src="snarkjs.min.js">   </script>
  
  <!-- This is the bundle generated by rollup.js -->
  <script>
const proofComponent = document.getElementById('proof');
const resultComponent = document.getElementById('result');
const winnerComponent = document.getElementById('winner');
const bGenProof = document.getElementById("bGenProof");

bGenProof.addEventListener("click", calculateProof);

async function calculateProof() {
    const { proof, publicSignals } =
      await snarkjs.groth16.fullProve( {"in": [40, 80]}, "bet2_even_or_odd.wasm", "bet2_even_or_odd_final.zkey");
    
    proofComponent.innerHTML = JSON.stringify(proof, null, 1);
    
    const vkey = await fetch("verification_key.json").then( function(res) {
        return res.json();
    });

    const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);
    if (res === true) {
        console.log("Verification OK");
        if (publicSignals[1] == 1)
            winnerComponent.innerHTML = JSON.stringify(`Alice - ${publicSignals[0]}`, null, 1);
        else winnerComponent.innerHTML = JSON.stringify(`Bob - ${publicSignals[0]}`, null, 1);
    } else {

        console.log("Invalid proof");
    }
    resultComponent.innerHTML = res;
}
  </script>
  
</body>
</html>